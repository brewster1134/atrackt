// Generated by CoffeeScript 1.12.7

/*
Atrackt Localytics Plugin
https://github.com/brewster1134/atrackt
@author Ryan Brewster
@version 1.0.2
 */

(function() {
  (function(factory) {
    if (typeof define !== "undefined" && define !== null ? define.amd : void 0) {
      return define(['atrackt'], function(Atrackt) {
        return factory(Atrackt);
      });
    } else {
      return factory(Atrackt);
    }
  })(function(Atrackt) {
    return Atrackt.setPlugin('localytics', {
      send: function(data, options) {
        var redirectUrl;
        if (this._isUiWebView()) {
          redirectUrl = this._getRedirectUrl(data, options);
          return this._redirect(redirectUrl);
        } else {
          return this._callTagMethod(data, options);
        }
      },
      _callTagMethod: function(data, options) {
        return typeof localyticsSession !== "undefined" && localyticsSession !== null ? localyticsSession.tagEvent(options.eventName, data) : void 0;
      },
      _isUiWebView: function() {
        return /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);
      },
      _getRedirectUrl: function(data, options) {
        var redirectUrl;
        redirectUrl = options.screenEvent ? "localytics://?screenEvent=" + options.eventName : "localytics://?event=" + options.eventName;
        if (Object.keys(data).length) {
          redirectUrl += "&attributes=" + (JSON.stringify(data));
        }
        return redirectUrl;
      },
      _redirect: function(url) {
        if (this._isUiWebView()) {
          return window.location = url;
        }
      }
    });
  });

}).call(this);
